<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LongLifeHisto - Flashcards Histologi</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library untuk Pan & Zoom -->
    <script src="https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fef3c7; /* amber-100 */
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23fcd34d' fill-opacity='0.3'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            overflow-x: hidden;
            /* Mencegah "pull-to-refresh" di mobile yang bisa mengganggu Panning */
            overscroll-behavior-y: contain;
        }
        .brand-title {
            font-family: 'Luckiest Guy', cursive;
            -webkit-text-stroke: 2px #3730a3; /* indigo-800 */
        }
        
        .flashcard { perspective: 1000px; }
        .flashcard-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.7s; transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            display: flex; align-items: center; justify-content: center;
            border-radius: 1.5rem; border: 4px solid #4f46e5; /* indigo-600 */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .flashcard-back { transform: rotateY(180deg); background-color: #e0e7ff; /* indigo-100 */ }
        
        /* Panzoom akan mengatur kursor, kita hanya perlu memastikan gambar tidak meluap */
        .flashcard-front {
            overflow: hidden;
        }
        #flashcard-img {
            /* Panzoom akan mengatur transform, jadi kita tidak perlu menambahkan style di sini */
            /* Kursor akan diatur secara dinamis oleh panzoom */
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #fffbeb; }
        ::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #f59e0b; }
    </style>
</head>
<body class="text-indigo-900">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="brand-title text-6xl md:text-7xl text-amber-400">LongLifeHisto</h1>
            <p class="text-indigo-800 mt-1 font-semibold text-lg">Simulasi Identifikasi Preparat Histologi</p>
        </header>

        <main id="main-content" class="bg-white/60 backdrop-blur-sm p-6 rounded-3xl shadow-lg border-2 border-amber-300 min-h-[60vh]">
            
            <div id="navigation-view">
                <button id="back-btn" class="hidden mb-4 text-indigo-600 hover:text-indigo-800 font-bold transition-colors duration-300">&larr; Kembali</button>
                <h3 id="kategori-title" class="font-bold text-2xl text-indigo-800 border-b-4 border-amber-300 pb-2 mb-6">Pilih Kategori (Blok)</h3>
                <div id="loading-folders" class="text-center text-amber-600 hidden">Memuat...</div>
                <ul id="folder-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </ul>
            </div>

            <div id="flashcard-view" class="hidden h-full flex flex-col items-center justify-between">
                <div class="w-full flex justify-between items-center">
                    <button id="exit-flashcard-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300">
                        &larr; Kembali ke Daftar
                    </button>
                    <span id="image-counter" class="text-indigo-800 font-semibold bg-amber-200 px-3 py-1 rounded-full"></span>
                </div>

                <div id="flashcard" class="flashcard w-full max-w-3xl aspect-video my-4">
                    <div class="flashcard-inner">
                        <div class="flashcard-front bg-gray-200">
                            <img id="flashcard-img" src="" alt="Gambar Preparat" class="w-full h-full object-contain">
                        </div>
                        <div class="flashcard-back">
                            <p id="flashcard-name" class="text-3xl md:text-4xl font-bold text-indigo-700 p-4 text-center" style="font-family: 'Luckiest Guy', cursive;"></p>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center justify-center w-full max-w-3xl space-x-2 md:space-x-4">
                    <button id="prev-btn" class="bg-amber-400 hover:bg-amber-500 text-indigo-900 font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        &larr; Prev
                    </button>
                    <button id="flip-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        Lihat Jawaban
                    </button>
                    <button id="next-btn" class="bg-amber-400 hover:bg-amber-500 text-indigo-900 font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        Next &rarr;
                    </button>
                </div>
                 <p class="text-xs text-indigo-500 mt-3">Gunakan scroll (laptop) atau pinch (HP) untuk zoom gambar.</p>
            </div>
        </main>
        
        <footer class="text-center mt-8 text-indigo-700/80">
            <p>Dibuat dengan ❤️ untuk para pejuang histologi.</p>
             <div class="flex justify-center items-center space-x-4 mt-2">
                <a href="https://www.instagram.com/beenspace" target="_blank" class="font-semibold hover:text-indigo-600 transition">@beenspace</a>
                <span class="opacity-50">|</span>
                <a href="https://github.com/muqorrobinize" target="_blank" class="font-semibold hover:text-indigo-600 transition">@muqorrobinize</a>
            </div>
        </footer>
    </div>

    <script>
        // --- PENGATURAN ---
        const githubUsername = 'muqorrobinize';
        const githubRepo = 'longlifehisto';

        // --- ELEMEN DOM ---
        const navigationView = document.getElementById('navigation-view');
        const flashcardView = document.getElementById('flashcard-view');
        const folderList = document.getElementById('folder-list');
        const flashcard = document.getElementById('flashcard');
        const flashcardImg = document.getElementById('flashcard-img');
        const flashcardName = document.getElementById('flashcard-name');
        const loadingFolders = document.getElementById('loading-folders');
        const backBtn = document.getElementById('back-btn');
        const kategoriTitle = document.getElementById('kategori-title');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const flipBtn = document.getElementById('flip-btn');
        const exitFlashcardBtn = document.getElementById('exit-flashcard-btn');
        const imageCounter = document.getElementById('image-counter');
        
        // --- STATE APLIKASI ---
        let pathHistory = [];
        let currentFiles = [];
        let currentIndex = 0;
        let pzInstance = null; // Instance untuk Panzoom
        
        // --- FUNGSI-FUNGSI ---

        function cleanFileName(fileName) {
            return fileName.split('.').slice(0, -1).join('.').replace(/_/g, ' ');
        }
        
        async function fetchAndDisplay(path = '', level = 'blocks') {
            navigationView.classList.remove('hidden');
            flashcardView.classList.add('hidden');
            folderList.innerHTML = '';
            loadingFolders.classList.remove('hidden');
            backBtn.classList.toggle('hidden', path === '');

            try {
                const response = await fetch(`https://api.github.com/repos/${githubUsername}/${githubRepo}/contents/${path}`);
                if (!response.ok) throw new Error(`Gagal memuat: ${response.statusText}`);
                const data = await response.json();
                
                const items = data.filter(item => item.type === 'dir');
                if (items.length === 0) {
                    folderList.innerHTML = `<li class="text-amber-700 col-span-full text-center">Tidak ada konten ditemukan.</li>`;
                    return;
                }

                kategoriTitle.textContent = level === 'blocks' ? 'Pilih Kategori (Blok)' : 'Pilih Sesi Praktikum';
                
                items.forEach(item => {
                    const li = document.createElement('li');
                    if (level === 'blocks') {
                         li.innerHTML = `<div class="p-5 bg-amber-200 rounded-2xl cursor-pointer hover:bg-amber-300 hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 text-center font-bold text-indigo-800 text-lg">${item.name.replace(/_/g, ' ')}</div>`;
                         li.onclick = () => { pathHistory.push(path); fetchAndDisplay(item.path, 'subfolders'); };
                    } else {
                        li.innerHTML = `<div class="p-4 bg-white rounded-xl cursor-pointer hover:bg-amber-100 transition duration-300 border-2 border-amber-200 font-semibold">${item.name.replace(/_/g, ' ')}</div>`;
                        li.onclick = () => { pathHistory.push(path); fetchFilesAndShowFlashcards(item.path); };
                    }
                    folderList.appendChild(li);
                });

            } catch (error) {
                console.error('Error fetching data:', error);
                folderList.innerHTML = `<li class="text-red-500 col-span-full text-center">Error: ${error.message}</li>`;
            } finally {
                loadingFolders.classList.add('hidden');
            }
        }
        
        async function fetchFilesAndShowFlashcards(folderPath) {
            navigationView.classList.add('hidden');
            flashcardView.classList.remove('hidden');
            
            try {
                const response = await fetch(`https://api.github.com/repos/${githubUsername}/${githubRepo}/contents/${folderPath}`);
                if (!response.ok) throw new Error(`Gagal memuat file: ${response.statusText}`);
                const data = await response.json();
                
                currentFiles = data.filter(item => item.type === 'file' && /\.(jpg|jpeg|png|gif)$/i.test(item.name));
                if (currentFiles.length > 0) {
                    currentIndex = 0;
                    updateFlashcardContent();
                } else {
                    // Tampilkan pesan jika tidak ada gambar dan sediakan tombol kembali
                    flashcardView.innerHTML = `
                        <p class="text-red-500 text-center my-auto">Tidak ada gambar ditemukan di sesi ini.</p>
                        <button onclick="document.getElementById('exit-flashcard-btn').click()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-full shadow-lg transition-all duration-300">
                            &larr; Kembali
                        </button>`;
                }
            } catch (error) {
                 console.error('Error fetching files:', error);
                 flashcardView.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
            }
        }
        
        function setupPanzoom() {
            // Hapus instance lama jika ada
            if (pzInstance) {
                pzInstance.dispose();
            }
            // Inisialisasi Panzoom pada gambar
            pzInstance = panzoom(flashcardImg, {
                maxZoom: 5,
                minZoom: 1,
                autocenter: true,
                // Menonaktifkan pan saat tidak di-zoom
                beforeMouseDown: function(e) {
                    // The panzoom library API uses getTransform().scale to get the zoom level
                    var shouldPan = pzInstance.getTransform().scale > 1;
                    return !shouldPan;
                }
            });
        }

        function updateFlashcardContent() {
            if (currentFiles.length === 0) return;
            flashcard.classList.remove('flipped');
            if (pzInstance) {
                // Manually reset zoom and position instead of using .reset()
                pzInstance.moveTo(0, 0);
                pzInstance.zoomAbs(0, 0, 1);
            }

            const file = currentFiles[currentIndex];
            flashcardImg.src = file.download_url;
            flashcardName.textContent = cleanFileName(file.name);
            imageCounter.textContent = `${currentIndex + 1} / ${currentFiles.length}`;

            // Setup Panzoom setelah gambar baru dimuat
            flashcardImg.onload = setupPanzoom;
        }
        
        // --- EVENT LISTENERS ---
        flipBtn.addEventListener('click', () => {
            if (pzInstance) {
                // Manually reset zoom and position instead of using .reset()
                pzInstance.moveTo(0, 0);
                pzInstance.zoomAbs(0, 0, 1);
            }
            flashcard.classList.toggle('flipped');
        });

        exitFlashcardBtn.addEventListener('click', () => {
            if (pzInstance) {
                pzInstance.dispose(); // Hapus instance saat keluar
                pzInstance = null;
            }
            const lastPath = pathHistory.pop() ?? '';
            fetchAndDisplay(lastPath, lastPath.includes('/') ? 'subfolders' : 'blocks');
        });
        
        backBtn.addEventListener('click', () => {
            const lastPath = pathHistory.pop() ?? '';
            fetchAndDisplay(lastPath, lastPath.includes('/') ? 'subfolders' : 'blocks');
        });

        nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % currentFiles.length;
            updateFlashcardContent();
        });

        prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + currentFiles.length) % currentFiles.length;
            updateFlashcardContent();
        });

        // --- INISIALISASI ---
        window.addEventListener('DOMContentLoaded', () => {
            fetchAndDisplay();
        });
    </script>
</body>
</html>

